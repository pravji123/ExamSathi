<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pricing & Plans</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f5f5f5; color: #333; }
    header { background: #0077cc; color: #fff; padding: 20px; text-align: center; }
    h1 { margin: 0; }

    .container { max-width: 1100px; margin: 30px auto; padding: 0 20px; }
    .pricing-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }

    .plan-card { background: #fff; border-radius: 10px; padding: 25px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); text-align: center; }
    .plan-card h2 { color: #0077cc; margin-bottom: 10px; }
    .plan-card .price { font-size: 28px; font-weight: bold; color: #28a745; margin: 10px 0; }
    .plan-card ul { list-style: none; padding: 0; margin: 15px 0; text-align: left; }
    .plan-card ul li { padding: 6px 0; border-bottom: 1px solid #eee; }

    .buy-btn { background: #ff6600; color: #fff; border: none; padding: 12px 20px; border-radius: 6px; font-size: 16px; cursor: pointer; transition: 0.2s; width: 100%; margin-top: 15px; }
    .buy-btn:hover { background: #e65c00; }

    .note { text-align: center; font-size: 14px; margin-top: 20px; color: #555; }
  </style>
</head>
<body>
  <header>
    <h1>Choose Your Plan</h1>
    <p>Get access to Paid Tests with flexible purchase options</p>
  </header>

  <div class="container">
    <div class="pricing-grid">
      <div class="plan-card" id="fullPlan">
        <h2>Full Access</h2>
        <div class="price" id="fullPrice">₹499</div>
        <p>One-time payment for lifetime access</p>
        <ul>
          <li>Unlock ALL Paid Tests</li>
          <li>Access Chapter, CA & Subject Tests</li>
          <li>Lifetime validity</li>
          <li>Priority support</li>
        </ul>
        <button class="buy-btn" onclick="purchase('full')">Buy Now Full Access</button>
      </div>

      <div class="plan-card" id="singlePlan">
        <h2>Single Test Access</h2>
        <div class="price" id="singlePrice">₹0</div>
        <p id="singleTestName">Selected Test</p>
        <ul>
          <li>Unlock only this test</li>
          <li>One-time payment</li>
          <li>Lifetime validity</li>
        </ul>
        <button class="buy-btn" onclick="purchase('single')">Buy Now Single Test</button>
      </div>
    </div>

    <div class="note">
      After purchase, you will be redirected back to the exam page with access unlocked.
    </div>
  </div>

  <!-- Razorpay Checkout -->
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script>
    const razorpayKey = "rzp_live_YOUR_LIVE_KEY_HERE"; // Replace with your Live key
    const fullAccessPrice = 49900; // ₹499 in paise

    const params = new URLSearchParams(window.location.search);
    const testFile = params.get('test');
    const plan = params.get('plan');

    // Hide plans dynamically
    if(plan === 'full') document.getElementById('singlePlan').style.display = 'none';
    else if(plan === 'single') document.getElementById('fullPlan').style.display = 'none';

    // Load test prices dynamically
    async function loadTestPrice(testName){
      try {
        const response = await fetch('tests.json'); // JSON file with test prices
        const tests = await response.json();
        const test = tests.find(t => t.name === testName);
        if(test){
          const pricePaise = test.price * 100;
          document.getElementById('singlePrice').textContent = `₹${test.price}`;
          return pricePaise;
        } else {
          document.getElementById('singlePrice').textContent = "₹0";
          return 0;
        }
      } catch(err){
        console.error(err);
        document.getElementById('singlePrice').textContent = "₹0";
        return 0;
      }
    }

    let singleTestAmount = 0;

    if(plan === 'single' && testFile){
      document.getElementById('singleTestName').textContent = `Test: ${testFile}`;
      loadTestPrice(testFile).then(amount => { singleTestAmount = amount; });
    }

    function purchase(selectedPlan){
      let amount = selectedPlan === 'full' ? fullAccessPrice : singleTestAmount;
      let name = selectedPlan === 'full' ? "Full Access" : "Single Test Access";
      let description = selectedPlan === 'full' ? "Unlock ALL Paid Tests" : `Unlock test: ${testFile || 'Unknown'}`;

      if(selectedPlan === 'single' && (!testFile || amount === 0)){
        alert("❌ Test not selected or price unavailable!");
        return;
      }

      const options = {
        key: razorpayKey,
        amount: amount,
        currency: "INR",
        name: name,
        description: description,
        image: "logo.png",
        handler: function (response){
          if(selectedPlan === 'full'){
            localStorage.setItem('userFullPaid', 'true');
            alert("✅ Full Access Unlocked!");
          } else {
            let paidTests = JSON.parse(localStorage.getItem('userPaidTests') || '[]');
            if(!paidTests.includes(testFile)){
              paidTests.push(testFile);
              localStorage.setItem('userPaidTests', JSON.stringify(paidTests));
            }
            alert(`✅ Test "${testFile}" Unlocked!`);
          }
          window.location.href = 'exam_details.html';
        },
        prefill: { name: "Test User", email: "user@example.com", contact: "9999999999" },
        theme: { color: "#0077cc" }
      };

      const rzp = new Razorpay(options);
      rzp.open();
    }
  </script>
</body>
</html>
