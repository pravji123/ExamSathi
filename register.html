<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login & Signup - Testara</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
  <style>
    :root {
      --primary-blue: #007bff;
      --primary-gradient: linear-gradient(to right, #007bff, #00c6ff);
      --form-bg: #fff;
      --text-dark: #333;
      --text-light: #777;
      --border-color: #ddd;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f0f2f5;
    }

    /* Full-page container */
    #authModal {
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      background: transparent;
    }

    .auth-container {
      width: 100%;
      height: 100%;
      display: flex;
      border-radius: 0;
      box-shadow: none;
      overflow: hidden;
    }

    /* Left side (blue) */
    .auth-left-panel {
      flex: 1;
      background: var(--primary-blue);
      color: #fff;
      padding: 40px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    .illustration {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      object-fit: cover;
      border: 5px solid rgba(255,255,255,0.3);
      margin-bottom: 30px;
    }

    /* Right side (white form) */
    .auth-right-panel {
      flex: 1;
      padding: 30px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      background: #fff;
      overflow-y: auto;
    }

    .auth-tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 1px solid var(--border-color);
    }

    .tab-btn {
      flex: 1;
      padding: 12px;
      border: none;
      background: none;
      cursor: pointer;
      font-size: 1.05rem;
      font-weight: 500;
      color: var(--text-light);
      border-bottom: 3px solid transparent;
      transition: all .2s;
    }

    .tab-btn.active {
      color: var(--primary-blue);
      font-weight: 700;
      border-bottom: 3px solid var(--primary-blue);
    }

    .auth-form {
      display: none;
    }

    .auth-form.active {
      display: block;
      animation: slideUp .25s ease-out;
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(6px); }
      to { opacity: 1; transform: none; }
    }

    .input-group {
      position: relative;
      margin-bottom: 18px;
    }

    .input-group input {
      width: 75%;
      padding: 12px 45px 12px 45px;
      border: none;
      border-bottom: 1px solid var(--border-color);
      font-size: 16px;
      background: transparent;
    }

    .input-group .icon {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-light);
    }

    .toggle-password {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      font-size: 16px;
      user-select: none;
    }

    .signin-options {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 18px;
      font-size: 0.9rem;
      color: var(--text-dark);
    }

    .signin-options a {
      color: var(--primary-blue);
      text-decoration: none;
    }

    .signin-options a:hover {
      text-decoration: underline;
    }
    .link{color:#0074cc;cursor:pointer;text-decoration:underline;font-size:14px}

    .checkbox-group {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
      font-size: 0.9rem;
      cursor:pointer;
    }

    .checkbox-group input {
      margin-right: 8px;
    }

    .btn-submit {
      width: 100%;
      margin-top: 10px;
      background: var(--primary-gradient);
      border-radius: 30px;
      padding: 14px;
      font-size: 1.05rem;
      font-weight: 700;
      color: #fff;
      border: none;
      cursor: pointer;
    }

    .password-hint, .password-rules {
      font-size: 13px;
      color: var(--text-light);
      margin-top: -12px;
      margin-bottom: 10px;
    }
    .password-rules{font-size:13px;margin-bottom:10px}
    .password-rules p{margin:2px 0}
    .valid { color: green; }
    .invalid { color: red; }

    #signupProgress {
      width: 0%;
      height: 6px;
      background: var(--primary-gradient);
      border-radius: 4px;
      margin-bottom: 12px;
      display: none;
      transition: width .2s ease;
    }

    @media(max-width: 800px) {
      .auth-container {
        flex-direction: column;
        height: 100%;
      }
      .auth-left-panel {
        display: none;
      }
      .auth-right-panel {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div id="authModal">
    <div class="auth-container">
      <div class="auth-left-panel">
        <h3>Join India's Smart Platform for Exam Preparation</h3>
        <img src="testara1.jpg" alt="Logo" class="illustration">
        <h1>Welcome to Testara</h1>
        <p>Your smart platform for exam preparation. Sign in to continue or sign up to get started!</p>
      </div>

      <div class="auth-right-panel">
        <div class="auth-tabs">
          <button class="tab-btn active" data-form="signin">Sign In</button>
          <button class="tab-btn" data-form="signup">Sign Up</button>
        </div>

        <!-- Sign In Form -->
        <form id="signin-form" class="auth-form active">
          <div class="input-group">
            <i class="fas fa-envelope icon"></i>
            <input id="signinEmail" type="email" placeholder="Email Address" required>
          </div>
          <div class="input-group">
            <i class="fas fa-lock icon"></i>
            <input id="signinPassword" type="password" placeholder="Password" required>
            <span class="toggle-password" onclick="togglePassword('signinPassword', this)">üëÅÔ∏è</span>
          </div>
          <div class="signin-options">
            <label><input id="rememberMe" type="checkbox" style="cursor: pointer;"> Remember me</label>
            <div class="link" onclick="openForgotView()">Forgot Password?</div>
          </div>
          <button type="submit" class="btn-submit">Sign In</button>
          <p>If you want to go Home <a href="index.html">Click Here</a></p>
        </form>

        <!-- Sign Up Form -->
        <form id="signup-form" class="auth-form">
          <div id="signupProgress"></div>
          <div class="input-group"><i class="fas fa-user icon"></i><input id="signupName" type="text" placeholder="Full Name" required></div>
          <div class="input-group"><i class="fas fa-envelope icon"></i><input id="signupEmail" type="email" placeholder="Email Address" required></div>
          <div class="input-group"><i class="fas fa-phone icon"></i><input id="signupPhone" type="tel" placeholder="Mobile Number" pattern="[0-9]{10}" required></div>
          <div class="input-group"><i class="fas fa-lock icon"></i><input id="password" type="password" placeholder="Create Password" oninput="checkPasswordRules()"><span class="toggle-password" onclick="togglePassword('password', this)">üëÅÔ∏è</span></div>
          <div class="input-group"><i class="fas fa-lock icon"></i><input id="confirmPassword" type="password" placeholder="Confirm Password" oninput="checkConfirmPassword()"><span class="toggle-password" onclick="togglePassword('confirmPassword', this)">üëÅÔ∏è</span></div>
          <p id="password-rules" class="password-hint">Password must be at least 8 characters, including uppercase, lowercase, number & symbol.</p>
          <div id="password-rules" class="password-rules" aria-hidden="true">
            <p id="length" class="invalid">At least 8 characters</p>
            <p id="upper" class="invalid">Contains uppercase letter</p>
            <p id="lower" class="invalid">Contains lowercase letter</p>
            <p id="number" class="invalid">Contains number</p>
            <p id="special" class="invalid">Contains special character (!@#...)</p>
          </div>
          <div id="confirmMsg" class="password-rules invalid"></div>
          <div class="checkbox-group"><input id="terms" type="checkbox" required><label for="terms">I agree to the <a href="/terms.html">Terms & Conditions</a> and <a href="/privacy.html">Privacy Policy</a>.</label></div>
          <button type="button" class="btn-submit" onclick="validateSignup()">Sign Up</button>
        </form>

        <!-- Forgot Password Form -->
        <form id="forgot-form" class="auth-form">
          <strong>Forgot your password?</strong>
          <p id="forgotText">Enter your email and we'll send a secure link to reset your password.</p>
          <div class="input-group"><i class="fas fa-envelope icon"></i><input id="forgotEmail" type="email" placeholder="Enter your email" required></div>
          <div style="display:flex;gap:8px;margin-bottom:12px;align-items:center">
            <button type="button" class="btn-submit" onclick="sendPasswordReset()">Send Reset Link</button>
            <button type="button" class="btn-submit" style="background:#eee;color:#333" onclick="switchToSignin()">Back</button>
          </div>
          <div id="forgotResult" style="font-size:0.95rem;color:var(--text-dark);"></div>
        </form>
      </div>
    </div>
  </div>

  <!-- Your Supabase Script (same as before) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = 'https://qzriaykqdrhbtcgbpxpg.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF6cmlheWtxZHJoYnRjZ2JweHBnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwMTcwMTAsImV4cCI6MjA3NTU5MzAxMH0.qRAQumkwN-JtxDizWwLRfPa8t0N68YGWdYKhQrhx7e8';
    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const tabs = document.querySelectorAll('.tab-btn');
    const forms = document.querySelectorAll('.auth-form');

    // tab switching
    tabs.forEach(tab => tab.addEventListener('click', () => {
      const target = tab.dataset.form;
      tabs.forEach(t=>t.classList.remove('active'));
      forms.forEach(f=>f.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById(target + '-form').classList.add('active');
    }));

    // Remember me autofill
    window.addEventListener('load', () => {
      const saved = localStorage.getItem('rememberEmail');
      if (saved) {
        const se = document.getElementById('signinEmail');
        if (se) se.value = saved;
        const rm = document.getElementById('rememberMe');
        if (rm) rm.checked = true;
      }
    });

    function togglePassword(id, el) {
      const input = document.getElementById(id);
      if (!input) return;
      if (input.type === 'password') { input.type = 'text'; el.textContent = 'üôà'; }
      else { input.type = 'password'; el.textContent = 'üëÅÔ∏è'; }
    }

    function checkPasswordRules(){
      const pass = document.getElementById('password').value || '';
      const rules = {
        length: pass.length >= 8,
        upper: /[A-Z]/.test(pass),
        lower: /[a-z]/.test(pass),
        number: /[0-9]/.test(pass),
        special: /[^A-Za-z0-9]/.test(pass)
      };
      Object.keys(rules).forEach(k=>{
        const el = document.getElementById(k);
        if (!el) return;
        el.className = rules[k] ? 'valid' : 'invalid';
      });
      checkConfirmPassword();
    }
    function checkConfirmPassword(){
      const pass = document.getElementById('password').value || '';
      const confirm = document.getElementById('confirmPassword').value || '';
      const msg = document.getElementById('confirmMsg');
      if (!msg) return;
      if (confirm.length === 0) { msg.textContent = ''; msg.className = ''; return; }
      if (confirm === pass) { msg.textContent = 'Passwords match ‚úÖ'; msg.className = 'valid'; }
      else { msg.textContent = 'Passwords do not match ‚ùå'; msg.className = 'invalid'; }
    }

    function switchToSignin(){
      forms.forEach(f=>f.classList.remove('active'));
      document.getElementById('signin-form').classList.add('active');
      tabs.forEach(t=>t.classList.remove('active'));
      document.querySelector('[data-form="signin"]').classList.add('active');
    }
    function openForgotView(){
      forms.forEach(f=>f.classList.remove('active'));
      document.getElementById('forgot-form').classList.add('active');
      tabs.forEach(t=>t.classList.remove('active'));
      document.getElementById('forgotText').textContent = "Enter your registered email. We'll send a secure reset link to that email.";
      document.getElementById('forgotResult').textContent = '';
    }

    async function validateSignup(){
      checkPasswordRules();
      checkConfirmPassword();
      const rulesSatisfied = document.querySelectorAll('#password-rules .valid').length === 5;
      const confirmOk = document.getElementById('confirmMsg').classList.contains('valid');
      const agreed = document.getElementById('terms').checked;

      if (!rulesSatisfied) { alert('Password does not meet all requirements.'); document.getElementById('password').focus(); return; }
      if (!confirmOk) { alert('Passwords do not match'); document.getElementById('confirmPassword').focus(); return; }
      if (!agreed) { alert('You must agree to the Terms & Conditions.'); return; }

      const name = document.getElementById('signupName').value.trim();
      const email = document.getElementById('signupEmail').value.trim();
      const phone = document.getElementById('signupPhone').value.trim();
      const password = document.getElementById('password').value;

      const slider = document.getElementById('signupProgress');
      slider.style.display = 'block';
      slider.style.width = '30%';

      try {
        const { data, error } = await sb.auth.signUp({
          email,
          password,
          options: { data: { full_name: name, phone } }
        });

        slider.style.width = '100%';
        setTimeout(()=>{ slider.style.display='none'; slider.style.width='0%'; }, 700);

        if (error) {
          alert('‚ùå Signup failed: ' + error.message);
          return;
        }

        alert('‚úÖ Signup successful! A verification email has been sent. Please verify your email before signing in.');
        switchToSignin();
        document.getElementById('signinEmail').value = email;
        document.getElementById('signinPassword').focus();

      } catch (err) {
        slider.style.display = 'none';
        slider.style.width = '0%';
        alert('‚ùå Signup error: ' + (err.message || err));
      }
    }

    document.getElementById('signin-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('signinEmail').value.trim();
      const password = document.getElementById('signinPassword').value;
      const rememberMe = document.getElementById('rememberMe').checked;

      try {
        const { data, error } = await sb.auth.signInWithPassword({ email, password });

        if (error) {
          alert('‚ùå Login failed: ' + error.message);
          return;
        }

        if (rememberMe) localStorage.setItem('rememberEmail', email);
        else localStorage.removeItem('rememberEmail');

        alert('‚úÖ Login successful! Redirecting...');
        // setTimeout(()=>{ window.location.href = 'index.html'; }, 600);
        window.top.location.href = 'index.html';

      } catch (err) {
        alert('‚ùå Login error: ' + (err.message || err));
      }
    });

    async function sendPasswordReset(){
      const email = document.getElementById('forgotEmail').value.trim();
      const resultEl = document.getElementById('forgotResult');
      if (!email) { resultEl.style.color = 'red'; resultEl.textContent = 'Please enter your email.'; return; }

      resultEl.style.color = 'var(--text-dark)';
      resultEl.textContent = 'Sending reset link...';

      try {
        const { data, error } = await sb.auth.resetPasswordForEmail(email);
        if (error) {
          resultEl.style.color = 'red';
          resultEl.textContent = 'Error sending reset link: ' + error.message;
          return;
        }

        resultEl.style.color = 'green';
        resultEl.textContent = 'If that email exists, a reset link has been sent. Please check your inbox (and spam).';
        setTimeout(()=>{ switchToSignin(); }, 2000);

      } catch (err) {
        resultEl.style.color = 'red';
        resultEl.textContent = 'Error: ' + (err.message || err);
      }
    }
  </script>
</body>
</html>
