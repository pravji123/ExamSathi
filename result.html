<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Your Test Result</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; background: #f4f6f9; margin: 0; padding: 0; }
    header { background: #007bff; color: white; padding: 15px; text-align: center; font-size: 1.4rem; }
    .container { max-width: 900px; margin: 20px auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 3px 8px rgba(0,0,0,0.1); }
    h2 { margin-top: 0; }
    table { width: 100%; border-collapse: collapse; margin: 20px 0; }
    th, td { padding: 10px; border: 1px solid #ddd; text-align: center; }
    th { background: #007bff; color: white; }
    .summary-box { display: flex; justify-content: space-around; flex-wrap: wrap; gap: 10px; }
    .card { background: #f8f9fa; padding: 15px; border-radius: 6px; text-align: center; flex: 1; min-width: 120px; }
    .btn { padding: 10px 16px; margin: 10px 5px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
    .btn-primary { background: #007bff; color: white; }
    .btn-secondary { background: #6c757d; color: white; }
    .btn-success { background: #28a745; color: white; }
    .hidden { display: none; }
    .review-question { background: #fff; margin-bottom: 15px; padding: 15px; border-radius: 6px; border: 1px solid #ddd; }
    .correct { color: green; font-weight: bold; }
    .wrong { color: red; font-weight: bold; }
    .explanation { background: #f1f1f1; padding: 8px; margin-top: 8px; border-left: 4px solid #007bff; }
  </style>
</head>
<body>

<header>üéâ Test Result</header>

<div class="container">
  <h2>Summary</h2>

  <div class="summary-box">
    <div class="card"><strong id="userName"></strong><br>üë§ Candidate</div>
    <div class="card"><strong id="totalQuestions"></strong><br>Total Questions</div>
    <div class="card"><strong id="attempted"></strong><br>Attempted</div>
    <div class="card"><strong id="correct"></strong><br>‚úÖ Correct</div>
    <div class="card"><strong id="wrong"></strong><br>‚ùå Wrong</div>
    <div class="card"><strong id="percentage"></strong>%<br>Score</div>
    <div class="card"><strong id="timeTaken"></strong><br>‚è± Total Time</div>
  </div>

  <table>
    <thead>
      <tr>
        <th>Test Name</th>
        <th>Total</th>
        <th>Attempted</th>
        <th>Correct</th>
        <th>Wrong</th>
        <th>Score</th>
        <th>Percentage</th>
        <th>Time Taken</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td id="t_testName"></td>
        <td id="t_total"></td>
        <td id="t_attempted"></td>
        <td id="t_correct"></td>
        <td id="t_wrong"></td>
        <td id="t_score"></td>
        <td id="t_percent"></td>
        <td id="t_time"></td>
      </tr>
    </tbody>
  </table>

  <div style="text-align:center;">
    <button class="btn btn-primary" onclick="toggleReview()">üìñ Review Questions</button>
    <button class="btn btn-secondary" onclick="window.location.href='index.html'">üè† Go Home</button>
  </div>

  <div id="reviewSection" class="hidden">
    <h2>Review Questions</h2>
    <div id="reviewList"></div>
  </div>
</div>

<script>
function loadResult(){
  const data = JSON.parse(localStorage.getItem("quizResult") || "{}");
  if(!data.questions){
    document.body.innerHTML = "<h2 style='text-align:center;color:red;'>No result found!</h2>";
    return;
  }

  const { name, total, correct, wrong, time, answers, questions, perQuestionTime, testTitle } = data;
  const attempted = correct + wrong;
  const percentage = ((correct / total) * 100).toFixed(2);
  const score = correct - (wrong * 0.25); // Assuming -0.25 per wrong

  // ‚úÖ Fill summary cards
  document.getElementById("userName").innerText = name;
  document.getElementById("totalQuestions").innerText = total;
  document.getElementById("attempted").innerText = attempted;
  document.getElementById("correct").innerText = correct;
  document.getElementById("wrong").innerText = wrong;
  document.getElementById("percentage").innerText = percentage;
  document.getElementById("timeTaken").innerText = time;

  // ‚úÖ Fill table row
  document.getElementById("t_testName").innerText= testTitle;
  document.getElementById("t_total").innerText = total;
  document.getElementById("t_attempted").innerText = attempted;
  document.getElementById("t_correct").innerText = correct;
  document.getElementById("t_wrong").innerText = wrong;
  document.getElementById("t_score").innerText = score.toFixed(2);
  document.getElementById("t_percent").innerText = percentage+"%";
  document.getElementById("t_time").innerText = time;

  // ‚úÖ Build Review List
  const reviewDiv = document.getElementById("reviewList");
  reviewDiv.innerHTML = "";

  questions.forEach((q, i) => {
    const userAns = answers[i] || "Not Answered";
    const isCorrect = userAns === q.answer;
    const timeSpent = perQuestionTime[i] ? perQuestionTime[i] + "s" : "0s";

    let html = `<div class="review-question">
      <p><strong>Q${q.globalIndex}:</strong> ${q.question}</p>
      <ul>`;
    q.options.forEach(opt => {
      let style = "";
      if(opt === q.answer) style = "‚úÖ Correct Answer";
      if(opt === userAns && !isCorrect) style = "‚ùå Your Choice";
      html += `<li>${opt} ${style ? "<span class='"+(opt===q.answer?"correct":"wrong")+"'>("+style+")</span>" : ""}</li>`;
    });
    html += `</ul>
      <p><strong>Your Answer:</strong> ${userAns === q.answer ? "<span class='correct'>"+userAns+"</span>" : userAns === "Not Answered" ? "<span style='color:gray'>Not Answered</span>" : "<span class='wrong'>"+userAns+"</span>"}</p>
      <p><strong>Correct Answer:</strong> <span class="correct">${q.answer}</span></p>
      <p><strong>Time Spent:</strong> ${timeSpent}</p>
      <div class="explanation"><strong>Explanation:</strong> ${q.explanation || "No explanation provided."}</div>
    </div>`;

    reviewDiv.innerHTML += html;
  });
}

function toggleReview(){
  document.getElementById("reviewSection").classList.toggle("hidden");
}

window.onload = loadResult;
</script>
</body>
</html>
