<!DOCTYPE html>
<html>
<head>
    <title>Test Creator – Answer Text Visible</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        body { font-family: Arial; display: flex; gap: 20px; }
        .left, .right { width: 50%; }
        textarea, input, select { width: 100%; margin-bottom: 6px; }
        button { padding: 6px 12px; }
        .count { font-weight: bold; margin-bottom: 10px; }
        .list {
            height: 400px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
        }
        .q-item {
            border-bottom: 1px dashed #aaa;
            padding-bottom: 8px;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>

<div class="left">
    <h3>Add Question</h3>

    <div class="count">
        Questions Added: <span id="count">0</span> / 10
    </div>

    <input type="text" id="title" placeholder="Test Title">

    <textarea id="question" placeholder="Question"></textarea>

    <input type="text" id="a" placeholder="Option A">
    <input type="text" id="b" placeholder="Option B">
    <input type="text" id="c" placeholder="Option C">
    <input type="text" id="d" placeholder="Option D">

    <select id="answer">
        <option value="">Right Answer</option>
        <option>A</option>
        <option>B</option>
        <option>C</option>
        <option>D</option>
    </select>

    <textarea id="explanation" placeholder="Explanation"></textarea>

    <button onclick="addQuestion()">Add Question</button>

    <hr>

    <button onclick="downloadJSON()" id="jsonBtn" disabled>Download JSON</button>
    <button onclick="downloadPDF()" id="pdfBtn" disabled>Download PDF</button>
</div>

<div class="right">
    <h3>Added Questions Preview</h3>
    <div class="list" id="preview"></div>
</div>

<script>
let questions = [];

function addQuestion() {

    if (questions.length >= 100) {
        alert("100 questions already added");
        return;
    }

    if (!question.value || !answer.value || !explanation.value) {
        alert("Fill all fields");
        return;
    }

    const options = {
        A: a.value,
        B: b.value,
        C: c.value,
        D: d.value
    };

    const q = {
        question: question.value,
        options: options,
        correct_answer: answer.value,
        correct_text: options[answer.value],
        explanation: explanation.value
    };

    questions.push(q);
    updatePreview();
    document.getElementById("count").innerText = questions.length;

    question.value = a.value = b.value = c.value = d.value = explanation.value = "";
    answer.value = "";

    if (questions.length === 10) {
        jsonBtn.disabled = false;
        pdfBtn.disabled = false;
        alert("100 Questions completed. Download enabled.");
    }
}

function updatePreview() {
    preview.innerHTML = "";
    questions.forEach((q, i) => {
        preview.innerHTML += `
            <div class="q-item">
                <b>${i + 1}. ${q.question}</b><br>
                A. ${q.options.A}<br>
                B. ${q.options.B}<br>
                C. ${q.options.C}<br>
                D. ${q.options.D}<br>
                <b>Answer:</b> ${q.correct_answer} – ${q.correct_text}<br>
                <i>Explanation:</i> ${q.explanation}
            </div>
        `;
    });
}

function downloadJSON() {
    const data = {
        test_title: title.value,
        total_questions: questions.length,
        questions: questions
    };

    const blob = new Blob(
        [JSON.stringify(data, null, 2)],
        { type: "application/json" }
    );

    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "test_100_questions.json";
    link.click();
}

function downloadPDF() {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();
    let y = 10;

    pdf.text(title.value || "Test Paper", 10, y);
    y += 10;

    questions.forEach((q, i) => {
        if (y > 270) { pdf.addPage(); y = 10; }

        pdf.text(`${i+1}. ${q.question}`, 10, y); y += 6;
        for (let k in q.options) {
            pdf.text(`${k}. ${q.options[k]}`, 12, y);
            y += 5;
        }
        pdf.text(`Answer: ${q.correct_answer} - ${q.correct_text}`, 12, y); 
        y += 5;
        pdf.text(`Explanation: ${q.explanation}`, 12, y); 
        y += 8;
    });

    pdf.save("test_100_questions.pdf");
}
</script>

</body>
      </html>
