<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mock Test - Testara</title>

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Arial,sans-serif}
body{background:#f4f6f9}

header{
  background:#007bff;
  color:#fff;
  padding:14px;
  text-align:center;
  font-size:1.2rem;
  font-weight:600;
}

.container{display:flex;min-height:82vh}
.left-panel{flex:4;background:#fff;border-right:2px solid #ddd}
.right-panel{flex:1;background:#f8f9fa;display:flex;flex-direction:column}

.meta-bar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 15px;
  border-bottom:1px solid #ddd;
}
.meta-left{display:flex;gap:18px;flex-wrap:wrap}

.question-box{
  padding:20px;
  background:#fff;
  border-radius:8px;
  margin:15px;
  box-shadow:0 2px 8px rgba(0,0,0,0.05);
}

input[type="radio"]{
  transform:scale(1.2);
  margin-right:8px;
  accent-color:#007bff;
}

.status-box{
  background:#fff;
  border:1px solid #ccc;
  margin:10px;
}
.status-box h3{
  text-align:center;
  padding:8px;
  background:#e9ecef;
}
.status-grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:10px;
  padding:10px;
}
.count-box{
  width:26px;height:26px;
  text-align:center;
  line-height:26px;
  font-weight:bold;
  border-radius:4px;
}
.green{background:#28a745;color:#fff}
.orange{background:#fd7e14;color:#fff}
.grey{background:#eee}

.question-navigator{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(38px,1fr));
  gap:8px;
  padding:10px;
  max-height:300px;
  overflow-y:auto;
}
.navigator-btn{
  height:36px;
  line-height:36px;
  text-align:center;
  font-weight:bold;
  border:2px solid #ccc;
  background:#eee;
  cursor:pointer;
  border-radius:4px;
}
.current-question{border-radius:50%}
.answered{background:#28a745;color:#fff}
.not-answered{background:#fd7e14;color:#fff}

footer{
  position:sticky;
  bottom:0;
  display:flex;
  background:#f8f9fa;
  padding:10px;
  border-top:1px solid #ccc;
  flex-wrap:wrap;
}
footer button{
  padding:8px 12px;
  border:none;
  border-radius:4px;
  cursor:pointer;
  color:#fff;
}
#clearBtn{background:#dc3545}
#backBtn{background:#6c757d}
#nextBtn{background:#28a745}
#submitBtn{background:#17a2b8;font-weight:bold}

#loader{
  position:fixed;
  top:0;left:0;
  width:100%;height:100%;
  background:rgba(255,255,255,0.95);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:9999;
}

@media(max-width:768px){
  .container{flex-direction:column-reverse}
  .meta-bar{flex-direction:column;gap:6px;font-size:14px}
  footer{flex-direction:column;gap:10px}
  footer button,#submitBtn{width:100%}
}
</style>
</head>

<body>

<div id="loader">
<div>
<div style="width:60px;height:60px;border:6px solid #ccc;border-top:6px solid #007bff;border-radius:50%;animation:spin 1s linear infinite;margin:auto"></div>
<p style="margin-top:15px;text-align:center">Loading Test...</p>
</div>
</div>

<header id="examName">Loading...</header>

<div class="container">

<div class="left-panel">

<div class="meta-bar">
<div>üë§ Guest</div>
<div>‚è± <span id="timer">00:00</span></div>
</div>

<div class="meta-bar">
<div class="meta-left">
<div id="question-number"></div>
</div>
</div>

<div id="question-box" class="question-box"></div>

</div>

<div class="right-panel">

<div class="status-box">
<h3>Status</h3>
<div class="status-grid">
<div><div id="answeredCount" class="count-box green">0</div> Answered</div>
<div><div id="notAnsweredCount" class="count-box orange">0</div> Not Answered</div>
<div><div id="notVisitedCount" class="count-box grey">0</div> Not Visited</div>
</div>
</div>

<div class="question-navigator" id="navigator"></div>

</div>
</div>

<footer>
<div style="flex:4;display:flex;gap:8px;flex-wrap:wrap">
<button id="clearBtn">Clear</button>
<button id="backBtn">Back</button>
<button id="nextBtn">Save & Next</button>
</div>
<div style="flex:1;text-align:center">
<button id="submitBtn">Submit</button>
</div>
</footer>

<script>
let questions=[]
let currentIndex=0
let answers={}
let visited={}
let remainingSeconds=0
let timerInterval

function getQueryParam(key){
return new URLSearchParams(window.location.search).get(key)
}

async function loadQuestions(){

const loader=document.getElementById("loader")
loader.style.display="flex"

const exam=getQueryParam("exam")||localStorage.getItem("lastExamKey")
const file=getQueryParam("file")||localStorage.getItem("lastFile")

if(!exam||!file){
loader.innerHTML="‚ùå Missing exam or file!"
return
}

localStorage.setItem("lastExamKey",exam)
localStorage.setItem("lastFile",file)

const path=`sets/${exam}/${file}`

try{
const res=await fetch(path)
if(!res.ok) throw new Error("File not found")

const data=await res.json()

document.getElementById("examName").textContent=data.examName||"Mock Test"
questions=data.questions
remainingSeconds=(data.time||30)*60

startTimer()
loadQuestion(0)

}catch(err){
loader.innerHTML="‚ùå Failed to load test!"
console.error(err)
return
}

loader.style.display="none"
}

function startTimer(){
timerInterval=setInterval(()=>{
const mins=String(Math.floor(remainingSeconds/60)).padStart(2,'0')
const secs=String(remainingSeconds%60).padStart(2,'0')
document.getElementById("timer").textContent=`${mins}:${secs}`
if(remainingSeconds<=0){
clearInterval(timerInterval)
alert("Time Up")
}
remainingSeconds--
},1000)
}

function loadQuestion(index){
currentIndex=index
visited[index]=true
const q=questions[index]

document.getElementById("question-number").innerHTML=
`Question No: <strong>${index+1}</strong>`

let html=`<p style="font-weight:bold;margin-bottom:12px">${q.question}</p>`

q.options.forEach((opt,i)=>{
const letter=`(${String.fromCharCode(65+i)})`
const checked=answers[index]===opt?"checked":""
html+=`
<label style="display:block;margin-bottom:8px;cursor:pointer">
<input type="radio" name="q${index}" value="${opt}"
${checked}
onchange="saveAnswer(${index},'${opt.replace(/'/g,"\\'")}')">
${letter} ${opt}
</label>`
})

document.getElementById("question-box").innerHTML=html
renderNavigator()
updateStatus()
}

function saveAnswer(i,val){
answers[i]=val
renderNavigator()
updateStatus()
}

function renderNavigator(){
const nav=document.getElementById("navigator")
nav.innerHTML=""
questions.forEach((q,i)=>{
const btn=document.createElement("div")
btn.classList.add("navigator-btn")
btn.innerText=i+1
if(answers[i])btn.classList.add("answered")
else if(visited[i])btn.classList.add("not-answered")
if(i===currentIndex)btn.classList.add("current-question")
btn.onclick=()=>loadQuestion(i)
nav.appendChild(btn)
})
}

function updateStatus(){
let answered=0,notVisited=0,notAnswered=0
questions.forEach((q,i)=>{
if(!visited[i])notVisited++
else if(answers[i])answered++
else notAnswered++
})
document.getElementById("answeredCount").innerText=answered
document.getElementById("notAnsweredCount").innerText=notAnswered
document.getElementById("notVisitedCount").innerText=notVisited
}

document.getElementById("clearBtn").onclick=()=>{
delete answers[currentIndex]
loadQuestion(currentIndex)
}
document.getElementById("backBtn").onclick=()=>{
if(currentIndex>0)loadQuestion(currentIndex-1)
}
document.getElementById("nextBtn").onclick=()=>{
if(currentIndex<questions.length-1)loadQuestion(currentIndex+1)
}

window.onload=loadQuestions
</script>

</body>
</html>
